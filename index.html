<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student AI Tutor</title>

<style>
body {
    margin: 0;
    font-family: 'Arial';
    background: #e5ddd5;
}

/* Header Gradient */
.header {
    background: linear-gradient(45deg, #25d366, #128C7E);
    color: white;
    padding: 18px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

/* Chat box */
.chat-box {
    height: 75vh;
    overflow-y: auto;
    padding: 15px;
    background: #ece5dd;
}

/* Chat bubbles */
.msg {
    max-width: 75%;
    padding: 10px 14px;
    margin: 8px 0;
    border-radius: 15px;
    font-size: 15px;
    line-height: 1.4;
}

/* User bubble (green like WhatsApp) */
.user {
    background: #dcf8c6;
    margin-left: auto;
    border-bottom-right-radius: 0;
}

/* Bot bubble (white like WhatsApp) */
.bot {
    background: white;
    margin-right: auto;
    border-bottom-left-radius: 0;
}

/* Input area */
.input-area {
    display: flex;
    padding: 10px;
    background: #f0f0f0;
}

.input-area input[type=text] {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 20px;
    outline: none;
    font-size: 15px;
}

/* File button */
#imgInput {
    margin-left: 8px;
}

/* Send button */
button {
    background: #25d366;
    border: none;
    color: white;
    padding: 12px 18px;
    border-radius: 50px;
    margin-left: 8px;
    font-size: 15px;
}
</style>

</head>
<body>

<div class="header">üìö Student AI Tutor</div>

<div class="chat-box" id="chatBox"></div>

<div class="input-area">
    <input type="text" id="msg" placeholder="Type your question...">
    <input type="file" id="imgInput" accept="image/*">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
async function sendMessage() {
    let text = document.getElementById("msg").value;
    let imgFile = document.getElementById("imgInput").files[0];
    let chat = document.getElementById("chatBox");

    if (!text && !imgFile) return;

    if (text) {
        chat.innerHTML += `<div class="msg user">${text}</div>`;
    }

    chat.innerHTML += `<div class="msg bot" id="loading">‚è≥ Processing...</div>`;
    chat.scrollTop = chat.scrollHeight;

    let imageBase64 = null;

    if (imgFile) {
        let reader = new FileReader();
        reader.onload = async function() {
            imageBase64 = reader.result.split(",")[1];
            await sendToPHP(text, imageBase64);
        };
        reader.readAsDataURL(imgFile);
    } else {
        await sendToPHP(text, null);
    }

    document.getElementById("msg").value = "";
}

async function sendToPHP(message, imgData) {
    let res = await fetch("api.php", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({message: message, image: imgData})
    });

    let data = await res.json();
    let reply = data.choices[0].message.content;

    document.getElementById("loading").outerHTML =
        `<div class="msg bot">${reply}</div>`;

    document.getElementById("chatBox").scrollTop =
        document.getElementById("chatBox").scrollHeight;
}
</script>

</body>
</html>
